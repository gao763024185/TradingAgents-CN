# 异动监控系统 - 美股支持更新

## 🚀 功能更新

### 新增美股代码支持

异动监控系统现已支持监控美股、港股和A股代码！

### 📊 支持的股票代码格式

| 市场 | 格式 | 示例 | 说明 |
|------|------|------|------|
| **A股** | 6位数字 | `000001`, `600519`, `920005` | 主板、中小板、创业板、科创板、新股等 |
| **美股** | 1-5位字母 | `AAPL`, `GOOGL`, `MSFT`, `TSLA`, `NVDA` | 纳斯达克、纽交所等 |
| **港股** | 4-5位数字或数字.HK | `0700`, `0700.HK`, `09988` | 香港交易所 |

### 🔧 技术实现

#### 1. 股票代码验证逻辑更新

**文件**: `tradingagents/dataflows/realtime_monitor.py`

```python
def _validate_stock_symbol(self, symbol: str) -> bool:
    """
    验证股票代码有效性（支持A股和美股）
    """
    if not symbol:
        return False
    
    symbol = symbol.upper().strip()
    
    # A股代码验证：6位数字
    if len(symbol) == 6 and symbol.isdigit():
        if symbol.startswith(('000', '001', '002', '003', '300', '600', '601', '603', '688', '920', '421', '430')):
            return True
    
    # 美股代码验证：1-5位字母，可包含数字和点号
    elif 1 <= len(symbol) <= 5 and symbol.replace('.', '').isalnum():
        if any(c.isalpha() for c in symbol):
            return True
    
    # 港股代码验证：4-5位数字（如 0700.HK）
    elif len(symbol) >= 4 and (symbol.isdigit() or symbol.endswith('.HK')):
        # ... 港股验证逻辑
    
    # 数据源验证作为后备验证
    # ...
```

#### 2. Web界面更新

**文件**: `web/components/anomaly_alerts.py`

- 更新输入提示：`"例如: 000001, AAPL, 0700.HK"`
- 移除6位长度限制
- 添加自动大写转换
- 更新错误提示信息

### 🧪 测试结果

#### 格式验证测试

```
股票代码验证测试:
==================================================
000001       -> ✅ 有效  (A股-平安银行)
600519       -> ✅ 有效  (A股-贵州茅台)
920005       -> ✅ 有效  (A股-新股)
AAPL         -> ✅ 有效  (美股-苹果)
GOOGL        -> ✅ 有效  (美股-谷歌)
MSFT         -> ✅ 有效  (美股-微软)
TSLA         -> ✅ 有效  (美股-特斯拉)
NVDA         -> ✅ 有效  (美股-英伟达)
0700.HK      -> ✅ 有效  (港股-腾讯)
INVALID123   -> ❌ 无效  (无效代码)
12345678     -> ❌ 无效  (长度错误)
```

#### 监控添加测试

```
测试添加美股代码到监控列表:
========================================
添加 AAPL   -> ✅ 成功
添加 GOOGL  -> ✅ 成功
添加 MSFT   -> ✅ 成功
添加 TSLA   -> ✅ 成功

当前监控列表:
  - TSLA
  - GOOGL
  - AAPL
  - MSFT
```

### 🎯 使用方法

#### Web界面使用

1. 访问 http://localhost:8501
2. 点击侧边栏"🚨 异动监控"
3. 在"添加股票代码"输入框中输入：
   - A股代码：`000001`, `600519`
   - 美股代码：`AAPL`, `GOOGL`, `MSFT`
   - 港股代码：`0700`, `0700.HK`
4. 点击"➕ 添加"按钮

#### 代码使用

```python
from tradingagents.dataflows.realtime_monitor import get_global_monitor

monitor = get_global_monitor()

# 添加不同市场的股票
monitor.add_stock("000001")    # A股
monitor.add_stock("AAPL")      # 美股
monitor.add_stock("0700.HK")   # 港股

# 开始监控
monitor.start_monitoring()
```

### 📝 注意事项

1. **数据源限制**: 
   - 当前数据源主要针对A股市场优化
   - 美股和港股数据获取可能受到网络和API限制
   - 建议优先监控A股代码以获得最佳体验

2. **实时数据**:
   - 美股和港股的实时数据获取依赖于数据源的支持情况
   - 如果数据源无法获取某只股票的数据，会在日志中显示警告

3. **监控策略**:
   - 异动检测算法对所有市场股票均有效
   - 建议根据交易时间合理设置监控间隔

### 🔮 未来计划

- [ ] 优化美股和港股数据源支持
- [ ] 添加市场特定的异动阈值设置
- [ ] 支持更多国际市场（日股、欧股等）
- [ ] 添加市场时区感知功能
- [ ] 优化跨市场异动分析

---

**更新时间**: 2025-07-31  
**版本**: v1.1.0  
**兼容性**: 完全向后兼容，现有A股监控功能不受影响