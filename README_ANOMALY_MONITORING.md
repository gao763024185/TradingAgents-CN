# 📊 TradingAgents-CN 异动监控系统

## 🚀 功能概述

异动监控系统是TradingAgents-CN的核心功能之一，能够实时监控股票价格异动（涨跌幅超过设定阈值），并自动调用多个分析师团队进行深度分析，为用户提供及时的投资决策参考。

## ✨ 核心特性

### 🔍 实时监控
- **分时数据获取**: 支持A股实时价格监控
- **异动检测**: 自动检测涨跌幅超过0.1%的价格变化
- **Redis存储**: 历史价格数据存储在Redis中，支持快速比较
- **监控间隔**: 默认5分钟监控间隔，可自定义调整

### 🤖 智能分析
- **市场分析师**: 技术面分析，价格趋势判断
- **新闻分析师**: 相关新闻事件分析，消息面影响评估  
- **基本面分析师**: 公司财务状况、估值分析
- **并行分析**: 多个分析师并行工作，提升分析效率
- **综合评估**: 自动生成综合分析报告和投资建议

### 🚨 消息提醒
- **页面提醒**: 页面右上角实时异动横幅提醒
- **侧边栏监控**: 左侧边栏显示监控状态和最新异动
- **弹窗通知**: 重要异动自动弹窗提醒
- **历史记录**: 完整的异动历史记录和分析结果

### 📈 可视化分析
- **异动曲线**: 详细的异动时间线图表
- **异动分布**: 异动幅度分布和类型统计
- **热力图**: 异动时间和频次热力图分析
- **统计报表**: 每日异动统计和趋势分析

## 🎯 监控参数配置

### 默认配置
```python
异动阈值: 0.1%      # 涨跌幅超过0.1%触发异动
监控间隔: 5分钟     # 每5分钟检查一次价格变化  
数据存储: Redis     # 历史价格存储在Redis中
分析师团队: 3个     # 市场、新闻、基本面分析师
```

### 推荐设置

| 场景 | 异动阈值 | 监控间隔 | 说明 |
|------|----------|----------|------|
| 日内交易 | 0.1% | 1-3分钟 | 高频监控，捕捉短期异动 |
| 波段操作 | 0.5% | 5-10分钟 | 中等频率，关注中期趋势 |
| 长期投资 | 1.0% | 15-30分钟 | 低频监控，关注重要变化 |

## 🔧 使用指南

### 1. 启动异动监控

#### Web界面操作
1. 访问 `http://localhost:8501`
2. 在左侧导航选择 "🚨 异动监控"
3. 添加要监控的股票代码（如：000001）
4. 点击 "▶️ 开始监控" 按钮

#### 代码方式启动
```python
from tradingagents.services.anomaly_service import start_anomaly_monitoring

# 启动异动监控
stocks = ["000001", "000002", "600036"]  # 要监控的股票
start_anomaly_monitoring(
    stocks=stocks,
    anomaly_threshold=0.1,  # 0.1%异动阈值
    monitor_interval=300    # 5分钟监控间隔
)
```

### 2. 查看异动提醒

#### 页面顶部横幅
- 显示最新3个异动事件
- 颜色区分：🔺绿色上涨，🔻红色下跌
- 包含股票代码、名称、涨跌幅、价格、时间等信息

#### 侧边栏监控面板
- 监控状态指示器（🟢运行中/🔴已停止）
- 监控配置信息展示
- 最新异动列表（支持展开查看详情）

#### 异动详情分析
- 点击异动项目的"分析"按钮
- 自动调用分析师团队进行深度分析
- 生成综合分析报告和投资建议

### 3. 异动曲线分析

在股票分析结果页面的 "📊 异动曲线" Tab页中：

#### 异动时间线
- 时间序列异动幅度变化图
- 异动价格变化趋势
- 上涨/下跌异动标记

#### 异动分布
- 异动幅度分布直方图
- 异动类型饼图统计
- 异动强度分级统计

#### 异动热力图
- 按时间段的异动频次热力图
- 异动强度热力图
- 异动模式分析

#### 异动统计
- 每日异动次数趋势
- 异动幅度变化趋势
- 成交量和价格关联分析

## 🛠️ 技术架构

### 核心模块

```
异动监控系统
├── 实时监控模块 (realtime_monitor.py)
│   ├── 股票数据获取
│   ├── 价格变化检测  
│   ├── 异动事件触发
│   └── Redis历史存储
├── 异动分析模块 (anomaly_analyst.py)
│   ├── 市场技术分析
│   ├── 新闻事件分析
│   ├── 基本面分析
│   └── 综合分析生成
├── 监控服务模块 (anomaly_service.py)
│   ├── 定时任务管理
│   ├── 服务状态监控
│   ├── 回调通知机制
│   └── 统计信息收集
├── 前端组件模块
│   ├── 异动提醒组件 (anomaly_alerts.py)
│   ├── 可视化图表 (anomaly_charts.py)
│   └── Web界面集成
└── 数据存储层
    ├── Redis缓存（价格历史）
    ├── 内存存储（分析结果）
    └── 日志记录（监控日志）
```

### 数据流程

```
1. 数据获取
   AKShare/Tushare → 实时股价数据

2. 异动检测  
   当前价格 vs Redis历史价格 → 计算涨跌幅

3. 异动分析
   异动事件 → 并行调用分析师 → 生成分析报告

4. 消息通知
   分析结果 → 前端提醒 → 用户决策参考

5. 数据存储
   价格数据 → Redis存储
   异动事件 → 内存列表
   分析结果 → 分析师历史
```

## 📊 API接口优化

为避免触及免费额度限制，系统采用以下优化策略：

### 数据源选择
- **优先级1**: AKShare（免费，实时数据）
- **优先级2**: Tushare（有限额度，历史数据）  
- **优先级3**: 本地缓存（备用数据）

### 调用频率控制
- 实时监控：5分钟间隔（避免频繁调用）
- 数据缓存：Redis存储历史价格（减少重复调用）
- 智能降级：API失败时自动切换数据源

### 分析师优化
- 并行执行：多个分析师并行工作（提升效率）
- 模板分析：使用分析模板减少LLM调用
- 缓存结果：相同股票短期内复用分析结果

## 📝 日志记录

系统提供全面的日志记录，便于监控和排查：

### 监控日志
```
📊 实时监控器初始化 - 异动阈值: 0.1%, 监控间隔: 300秒
📈 已添加监控股票: 000001
🚀 开始监控 2 只股票
🔍 检查股票异动: 000001
📈 000001 价格变化: 12.20 -> 12.50 (2.459%)
🚨 检测到异动 000001: surge 2.459%
💾 已存储异动事件: 000001 surge
```

### 分析日志
```
🚨 开始分析异动: 000001 平安银行 (2.46%)
⚡ 并行执行 3 个分析任务...
📈 开始市场技术分析: 000001
📰 开始新闻事件分析: 000001  
📊 开始基本面分析: 000001
✅ 异动分析完成: 000001 (耗时: 4.23秒)
📋 分析结论: 关注回调买入机会 (置信度: 0.80)
```

### 服务日志
```
🎯 异动监控服务初始化完成
🚀 异动监控服务已启动
📢 已发送异动通知: 000001 (共1个回调)
⏹️ 监控已停止
```

## 🔧 配置建议

### Redis配置
```bash
# 环境变量配置
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=your_password
REDIS_DB=0

# 数据过期设置
价格数据TTL: 1小时
异动事件TTL: 7天
```

### 监控策略
```python
# 保守策略（长期投资者）
anomaly_threshold = 1.0     # 1%异动阈值
monitor_interval = 900      # 15分钟间隔

# 均衡策略（中期投资者） 
anomaly_threshold = 0.5     # 0.5%异动阈值
monitor_interval = 300      # 5分钟间隔

# 激进策略（短期交易者）
anomaly_threshold = 0.1     # 0.1%异动阈值  
monitor_interval = 60       # 1分钟间隔
```

## ⚠️ 注意事项

### 使用限制
1. **API额度**: 注意各数据源的调用限制，避免超额使用
2. **网络稳定**: 确保网络连接稳定，避免数据获取失败
3. **Redis依赖**: 需要Redis服务支持，用于历史数据存储
4. **内存使用**: 监控股票数量过多可能占用较多内存

### 投资风险
1. **仅供参考**: 异动分析结果仅供参考，不构成投资建议
2. **风险控制**: 请结合个人风险承受能力进行投资决策
3. **多方验证**: 建议结合多种分析工具和信息源
4. **专业咨询**: 重大投资决策建议咨询专业投资顾问

### 技术风险
1. **数据延迟**: 实时数据可能存在延迟，影响异动检测准确性
2. **系统故障**: 监控系统可能因各种原因中断，需要定期检查
3. **误报风险**: 市场波动可能导致误报，需要人工判断确认

## 🔮 未来规划

### 功能扩展
- [ ] 支持港股、美股异动监控
- [ ] 增加更多技术指标异动检测
- [ ] 微信/邮件通知功能
- [ ] 异动预警机器人

### 性能优化  
- [ ] 分布式监控架构
- [ ] 更高效的数据存储方案
- [ ] AI模型优化和加速
- [ ] 实时WebSocket推送

### 界面增强
- [ ] 移动端适配
- [ ] 更丰富的图表类型
- [ ] 自定义监控面板
- [ ] 异动回放功能

---

## 📞 技术支持

如有问题或建议，请通过以下方式联系：

- 📧 GitHub Issues
- 💬 项目讨论区
- 📱 技术交流群

**祝您投资顺利！** 🚀📈 